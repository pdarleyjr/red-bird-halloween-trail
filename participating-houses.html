<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Participating Houses - Red Bird Trick-or-Treat Trail</title>
  <meta name="description" content="View all participating houses in the Red Bird neighborhood trick-or-treat trail with their fun theme names and addresses.">
  <meta property="og:title" content="Participating Houses - Red Bird Trick-or-Treat Trail">
  <meta property="og:description" content="View all participating houses in the Red Bird neighborhood trick-or-treat trail with their fun theme names and addresses.">
  <meta property="og:image" content="assets/flyer/flyer.png">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="icon" href="assets/brand/Red_Bird_Logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#D97C1E">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to content</a>
  <main class="container" id="main-content">
    <a href="index.html" class="back-link">← Back to Home</a>

    <h1>🎃 Participating Houses 🎃</h1>
    <p style="text-align: center; color: var(--cream); font-size: 1rem; margin: 0 0 1.5rem 0; text-shadow: 0 2px 6px rgba(0,0,0,0.5);">
      Visit these spooky stops for treats and frights!
    </p>

    <section id="houses" class="houses-grid">
      <!-- Houses will be loaded here via JavaScript -->
    </section>
  </main>

  <script type="module">
    import Papa from 'https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js';
    const parse = Papa.parse;

    fetch('data/participants.csv')
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}: ${r.statusText}`);
        return r.text();
      })
      .then(t => {
        const parsed = parse(t, { header: true });
        if (parsed.errors.length > 0) {
          console.warn('CSV parse warnings:', parsed.errors);
        }
        return parsed.data;
      })
      .then(rows => {
        const list = document.querySelector('#houses');
        
        // Debug: log raw data
        console.log('Total rows:', rows.length);
        console.log('First row keys:', rows[0] ? Object.keys(rows[0]) : 'no rows');
        console.log('Sample row:', rows[0]);

        // Filter and sort houses with theme names
        const themeColumnName = 'Would you like to give your house a fun "Trick-or-Treat Name" for the map?';
        const houses = rows
          .filter(r => r[themeColumnName]?.trim())
          .map(r => ({
            name: r[themeColumnName].trim(),
            address: r['Address ']?.trim() || r['Address']?.trim() || '',
            household: r['Household Name']?.trim() || ''
          }))
          .sort((a, b) => a.name.localeCompare(b.name));

        console.log('Filtered houses:', houses.length, houses);

        if (houses.length === 0) {
          list.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--cream);">No participating houses found. Check the CSV data.</p>';
          return;
        }

        houses.forEach(house => {
          const blurb = `A ${house.name} stop with festive lights and friendly frights — don't miss the treats!`;
          list.insertAdjacentHTML('beforeend', `
            <article class="house card">
              <h3>${house.name}</h3>
              <p class="addr">${house.address}</p>
              <p class="desc">${blurb}</p>
            </article>`);
        });
      })
      .catch(error => {
        console.error('Error loading participating houses:', error);
        document.querySelector('#houses').innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--cream);">Sorry, unable to load the list of participating houses at this time. Error: ' + error.message + '</p>';
      });
  </script>
    <a href="index.html" class="home-fab" title="Back to home">🏠</a>
</body>
</html>
